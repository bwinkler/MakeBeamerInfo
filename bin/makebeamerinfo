#!/usr/bin/env perl

use strict;
use warnings;

use Getopt::Long;
use Pod::Usage;

#============================
# Parse in command line options 

my $opt_nav; # command option for nav file
my $opt_pdf; # command option for pdf file
my $help; # command switch to display help
my $if_gui; # boolean of operational mode, 1 = GUI, 0 = CLI
my $class; # full class name to invoke

BEGIN {
  $help = 0;
  $if_gui = ! @ARGV; # If no options given assume GUI mode
  GetOptions(
    'gui'    => \$if_gui,
    'help|?' => \$help,
    'nav:s'  => \$opt_nav,
    'pdf:s'  => \$opt_pdf,
  );

  pod2usage(0) if $help;

  if ($if_gui) {

    # test for Tk
    eval { require Tk };
    if ($@) {
      print <<MESSAGE;
Error: makebeamerinfo's "GUI mode" requires the Tk module to be installed.

Installation may be accomplished from CPAN using the command `cpan Tk` with
apropriate permissions. Many system package managers also provide Tk, on
Ubuntu Linux `sudo apt-get install perl-tk` should do the trick.
MESSAGE
      exit(1);
    }

    # Tk is present set $class
    $class = 'App::makebeamerinfo::GUI';
  } else {
    # CLI mode
    $class = 'App::makebeamerinfo::CLI';
  }

}

# use 'if' module to avoid bareword problem
use if 1, $class;

#============================
# Use known information to find files

while (@ARGV) {
  my $arg = shift @ARGV;
  
  if ($arg =~ /\.nav$/) {
    $opt_nav = $arg;
  }

  if ($arg =~ /\.pdf$/) {
    $opt_pdf = $arg;
  }
}

my $app = $class->new( pdf => $opt_pdf, nav => $opt_nav );

#============================
# Start one interface or the other

$app->run;

## POD (my editor doesn't highlight after END tag)

=head1 NAME

makebeamerinfo - Creates .info file for use with Impressive and LaTeX Beamer

=head1 SYNOPSIS

  makebeamerinfo                        # No args starts the program in GUI mode
  makebeamerinfo -p document.pdf        # Explicitly specify location of .pdf file
  makebeamerinfo --help/-h              # Shows a usage message

=head1 DESCRIPTION

Impressive is a pdf viewer that aids in viewing presentations made in LaTeX Beamer. Impressive uses a .info control file to specify the transitions used between pages. While is file isn't necessary, the Beamer-based presentation can be presented in a much more consistant style when the .info file is tuned to the individual presentation. C<makebeamerinfo> is designed to create this file based on an auxiliary file (F<.nav>) that Beamer creates in parallel with the presentation. It also does not require any configuration or tags in the presentation source.

=head1 OPTIONS AND ARGUMENTS

  makebeamerinfo [arguments] [files]

  Run with no arguments or files starts the program in GUI mode

  -g
  --gui 
      Explicitly request GUI mode

  -p
  --pdf
      Explicitly specify location of .pdf file

  -n
  --nav
      Explicitly specify location of .nav file

  Additional files may be specified without flags,
  their file type(s) will be inferred by file extension

  -h
  --help
      Shows a usage message and exit. Overrides all other options.

=cut

